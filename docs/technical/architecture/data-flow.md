# ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… (Data Flow)

## ĞĞ±Ğ·Ğ¾Ñ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ĞŸĞĞ¢ĞĞšĞ˜ Ğ”ĞĞĞĞ«Ğ¥                                    â”‚
â”‚                                                                             â”‚
â”‚   ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â”€â”€â–¶ Frontend â”€â”€â–¶ API â”€â”€â–¶ Cache/External APIs â”€â”€â–¶ Response   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. ĞŸĞ¾Ğ¸ÑĞº ĞĞ¸ÑˆĞ¸ (ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Flow)

### ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ĞŸĞĞ˜Ğ¡Ğš ĞĞ˜Ğ¨Ğ˜: "gratitude journal"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[1] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
        â”‚
        â”‚  Ğ’Ğ²Ğ¾Ğ´: "gratitude journal"
        â–¼
[2] Frontend (Next.js)
        â”‚
        â”‚  POST /api/search
        â”‚  { query: "gratitude journal", userId: "uuid-123" }
        â–¼
[3] API Route (/api/search)
        â”‚
        â”œâ”€â”€â–¶ [3a] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
        â”‚         â””â”€â”€ Supabase Auth â†’ JWT valid? â†’ âœ“
        â”‚
        â”œâ”€â”€â–¶ [3b] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²
        â”‚         â””â”€â”€ SELECT searches_this_month FROM profiles
        â”‚         â””â”€â”€ Free: < 5? â†’ âœ“ | Pro: unlimited
        â”‚
        â””â”€â”€â–¶ [3c] ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¸ÑĞº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼
[4] Cache Check         [5] Cache Check
    key: "bsr:gratitude     key: "kw:gratitude
          journal"                journal:us"
        â”‚                         â”‚
        â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ HIT?  â”‚                 â”‚ HIT?  â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜                 â””â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚                         â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”                 â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚  YES  â”‚  NO             â”‚  YES  â”‚  NO
    â”‚   â”‚   â”‚  â”‚              â”‚   â”‚   â”‚  â”‚
    â”‚   â–¼   â”‚  â–¼              â”‚   â–¼   â”‚  â–¼
    â”‚ Returnâ”‚ [6] Keepa API   â”‚ Returnâ”‚ [7] Keywords API
    â”‚ cachedâ”‚     â”‚           â”‚ cachedâ”‚     â”‚
    â”‚       â”‚     â–¼           â”‚       â”‚     â–¼
    â”‚       â”‚ BSR, Ñ†ĞµĞ½Ñ‹,      â”‚       â”‚ Search volume
    â”‚       â”‚ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹          â”‚       â”‚ 50,000/Ğ¼ĞµÑ
    â”‚       â”‚     â”‚           â”‚       â”‚     â”‚
    â”‚       â”‚     â–¼           â”‚       â”‚     â–¼
    â”‚       â”‚ Save to cache   â”‚       â”‚ Save to cache
    â”‚       â”‚ TTL: 24h        â”‚       â”‚ TTL: 7d
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
[8] Calculate Niche Score
        â”‚
        â”‚  demand = f(BSR, searchVolume)
        â”‚  competition = f(reviews, bookAge)
        â”‚  opportunity = f(newBooks, priceSpread)
        â”‚
        â”‚  total = demand*0.4 + competition*0.35 + opportunity*0.25
        â”‚
        â–¼
[9] Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
        â”‚
        â”‚  INSERT INTO search_logs (user_id, query, results_count)
        â”‚  UPDATE profiles SET searches_this_month = +1
        â”‚
        â–¼
[10] Response
        â”‚
        â”‚  {
        â”‚    nicheScore: 72,
        â”‚    demand: 85,
        â”‚    competition: 55,
        â”‚    opportunity: 70,
        â”‚    topBooks: [...],
        â”‚    searchVolume: 50000  // Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Pro
        â”‚  }
        â”‚
        â–¼
[11] Frontend Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
```

---

## 2. Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: Cache-Aside Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CACHE-ASIDE PATTERN                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Client    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ request
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   API       â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                       â”‚
                         â–¼                       â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
              â”Œâ”€â”€â”€â”‚    Cache    â”‚                â”‚
              â”‚   â”‚  (Supabase) â”‚                â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
              â”‚         â”‚                        â”‚
         HIT  â”‚         â”‚ MISS                   â”‚
              â”‚         â–¼                        â”‚
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
              â”‚   â”‚ External APIâ”‚                â”‚
              â”‚   â”‚ (Keepa/KW)  â”‚                â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
              â”‚          â”‚                       â”‚
              â”‚          â”‚ response              â”‚
              â”‚          â–¼                       â”‚
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
              â”‚   â”‚ Write Cache â”‚                â”‚
              â”‚   â”‚  + TTL      â”‚                â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
              â”‚          â”‚                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Response   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ĞšĞ»ÑÑ‡ĞµĞ¹ Cache

```typescript
// Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
const cacheKeys = {
  bsr:       `bsr:${asin}`,                    // bsr:B08XYZ123
  keyword:   `kw:${keyword}:${country}`,       // kw:gratitude journal:us
  category:  `cat:${categoryId}`,              // cat:digital-ebook-journals
  niche:     `niche:${query}`,                 // niche:gratitude journal
  notFound:  `404:${type}:${id}`,              // 404:asin:B00INVALID
};
```

---

## 3. ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Login Flow]

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
    â”‚
    â”‚ email + password
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚
â”‚  /login     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ signInWithPassword()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase   â”‚
â”‚    Auth     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â–¶ ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ credentials
       â”‚         â”‚
       â”‚         â–¼
       â”‚    auth.users
       â”‚         â”‚
       â”‚         â–¼
       â”‚    Valid? â”€â”€â”€ No â”€â”€â–¶ Error: "Invalid credentials"
       â”‚      â”‚
       â”‚     Yes
       â”‚      â”‚
       â”‚      â–¼
       â”œâ”€â”€â–¶ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ JWT Token
       â”‚         â”‚
       â”‚         â–¼
       â”‚    { sub: "uuid-123", email: "...", exp: ... }
       â”‚         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â–¶ Set cookies
                           â”‚
                           â–¼
                     Redirect â†’ /dashboard


[ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ API Request]

Request
    â”‚
    â”‚ Cookie: sb-access-token=...
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ getUser() / getSession()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase   â”‚â”€â”€â–¶ Verify JWT
â”‚  Auth       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€ Valid â†’ return user object
       â”‚
       â””â”€â”€ Invalid â†’ 401 Unauthorized
```

---

## 4. ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶Ğ½Ñ‹Ğ¹ Flow (Stripe)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ĞŸĞ›ĞĞ¢ĞĞ– Ğ—Ğ PRO                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Ğ¨Ğ°Ğ³ 1: Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°]

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
    â”‚
    â”‚ Click: "Upgrade to Pro"
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚
â”‚  /pricing   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/create-checkout-session
       â”‚ { priceId: "price_pro_monthly", userId: "uuid-123" }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ stripe.checkout.sessions.create({
       â”‚   mode: 'subscription',
       â”‚   customer_email: user.email,
       â”‚   line_items: [{ price: priceId }],
       â”‚   success_url: '/dashboard?upgraded=true',
       â”‚   cancel_url: '/pricing'
       â”‚ })
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Stripe    â”‚â”€â”€â–¶ Return checkout URL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Redirect â†’ Stripe Checkout Page


[Ğ¨Ğ°Ğ³ 2: ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ½Ğ° Stripe]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             STRIPE CHECKOUT                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  KDP Niche Finder Pro                       â”‚
â”‚  $19.00/month                               â”‚
â”‚                                             â”‚
â”‚  [Card Number]                              â”‚
â”‚  [MM/YY]  [CVC]                            â”‚
â”‚                                             â”‚
â”‚  [Pay $19.00]                               â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹
       â–¼
Stripe Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶
       â”‚
       â”‚
       â”œâ”€â”€ Success â†’ Redirect to success_url
       â”‚                    â”‚
       â”‚                    â–¼
       â”‚              /dashboard?upgraded=true
       â”‚
       â””â”€â”€ Fail â†’ Redirect to cancel_url


[Ğ¨Ğ°Ğ³ 3: Webhook Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ±Ğ°Ğ·Ñƒ]

Stripe
    â”‚
    â”‚ POST /api/webhooks/stripe
    â”‚ Event: checkout.session.completed
    â”‚ { customer_email: "user@example.com", subscription: "sub_xxx" }
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route  â”‚
â”‚  /webhooks  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Verify webhook signature
       â”‚ 2. Parse event data
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ UPDATE profiles
       â”‚ SET plan = 'pro',
       â”‚     stripe_customer_id = 'cus_xxx',
       â”‚     stripe_subscription_id = 'sub_xxx'
       â”‚ WHERE email = 'user@example.com';
       â”‚
       â–¼
User is now Pro! ğŸ‰


[Ğ¨Ğ°Ğ³ 4: Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ğ¾Ğµ ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ]

Stripe (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼ĞµÑÑÑ†)
    â”‚
    â”‚ Charge $19.00
    â”‚
    â”œâ”€â”€ Success â†’ Event: invoice.paid
    â”‚                 â”‚
    â”‚                 â–¼
    â”‚         Webhook â†’ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
    â”‚
    â””â”€â”€ Fail â†’ Event: invoice.payment_failed
                    â”‚
                    â–¼
              Webhook â†’
                â”‚
                â”œâ”€â”€ Email Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                â””â”€â”€ ĞŸĞ¾ÑĞ»Ğµ 3 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº â†’ plan = 'free'
```

---

## 5. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞĞ¸ÑˆĞ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ• ĞĞ˜Ğ¨Ğ˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ (Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²)
    â”‚
    â”‚ Click: "ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ"
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/saved
       â”‚ {
       â”‚   query: "gratitude journal",
       â”‚   nicheScore: 72,
       â”‚   data: { ... Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ... }
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
       â”‚ 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½ (Pro = unlimited, Free = 3 max)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ INSERT INTO saved_niches (
       â”‚   user_id,
       â”‚   query,
       â”‚   niche_score,
       â”‚   data
       â”‚ ) VALUES (...);
       â”‚
       â–¼
Response: { success: true, savedNicheId: "uuid-456" }
```

---

## 6. ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞšÑÑˆĞ° (Cron)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ ĞšĞ­Ğ¨Ğ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 6 Ñ‡Ğ°ÑĞ¾Ğ²)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GitHub Actions
    â”‚
    â”‚ schedule: '0 */6 * * *'
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workflow Run   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ curl -X POST
         â”‚ "$SUPABASE_URL/rest/v1/rpc/cleanup_expired_cache"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase     â”‚
â”‚   PostgreSQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ DELETE FROM cache
         â”‚ WHERE expires_at < NOW();
         â”‚
         â–¼
Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ âœ“


[SQL Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ]

CREATE OR REPLACE FUNCTION cleanup_expired_cache()
RETURNS void AS $$
BEGIN
  DELETE FROM cache WHERE expires_at < NOW();
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

---

## 7. Supabase Ping (ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PING SUPABASE (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 6 Ğ´Ğ½ĞµĞ¹)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GitHub Actions
    â”‚
    â”‚ schedule: '0 0 */6 * *'  # ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 6 Ğ´Ğ½ĞµĞ¹
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workflow Run   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ curl -X GET
         â”‚ "$SUPABASE_URL/rest/v1/profiles?limit=1"
         â”‚ -H "apikey: $SUPABASE_ANON_KEY"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Query Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ â†’ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
         â”‚ Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ¿Ğ°ÑƒĞ·Ñ‹ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½
         â”‚
         â–¼
Supabase Ğ½Ğµ ÑƒĞ¹Ğ´Ñ‘Ñ‚ Ğ² Ğ¿Ğ°ÑƒĞ·Ñƒ âœ“


[ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾]

Free tier Supabase:
â”œâ”€â”€ ĞŸĞ°ÑƒĞ·Ğ° Ğ¿Ğ¾ÑĞ»Ğµ 7 Ğ´Ğ½ĞµĞ¹ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
â”œâ”€â”€ ĞŸÑ€Ğ¸ Ğ¿Ğ°ÑƒĞ·Ğµ â€” Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
â””â”€â”€ ĞÑƒĞ¶Ğ½Ğ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ "Ğ±ÑƒĞ´Ğ¸Ñ‚ÑŒ" Ğ² dashboard

Ping ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 6 Ğ´Ğ½ĞµĞ¹:
â””â”€â”€ ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¿Ğ°ÑƒĞ·Ñƒ
```

---

## 8. Row Level Security (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬ Ğ”ĞĞĞĞ«Ğ¥ (RLS)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· RLS]

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ A
    â”‚
    â”‚ SELECT * FROM saved_niches
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Ğ’Ğ¡Ğ• Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹! ğŸ˜±


[Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: RLS]

-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ RLS
ALTER TABLE saved_niches ENABLE ROW LEVEL SECURITY;

-- ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
CREATE POLICY "Users can only see own niches"
ON saved_niches FOR SELECT
USING (auth.uid() = user_id);

-- ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸
CREATE POLICY "Users can only insert own niches"
ON saved_niches FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸
CREATE POLICY "Users can only delete own niches"
ON saved_niches FOR DELETE
USING (auth.uid() = user_id);


[Ğ¡ RLS]

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ A (uuid: "aaa-111")
    â”‚
    â”‚ SELECT * FROM saved_niches
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase     â”‚â”€â”€â–¶ WHERE user_id = 'aaa-111' (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸!)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ A âœ“
```

---

## 9. Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ’ÑĞµÑ… ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²

| Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | Endpoint | ĞœĞµÑ‚Ğ¾Ğ´ | Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | Cache |
|----------|----------|-------|-----------------|-------|
| ĞŸĞ¾Ğ¸ÑĞº Ğ½Ğ¸ÑˆĞ¸ | `/api/search` | POST | Keepa + Keywords | âœ“ |
| Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ½Ğ¸ÑˆĞ¸ | `/api/niche/[id]` | GET | Cache/Keepa | âœ“ |
| Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ½Ğ¸ÑˆÑƒ | `/api/saved` | POST | â€” | â€” |
| Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ñ… | `/api/saved` | GET | Supabase | â€” |
| Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½ÑƒÑ | `/api/saved/[id]` | DELETE | Supabase | â€” |
| Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° | `/api/usage` | GET | Supabase | â€” |
| Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ checkout | `/api/create-checkout-session` | POST | Stripe | â€” |
| Webhook Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ° | `/api/webhooks/stripe` | POST | Stripe â†’ Supabase | â€” |

---

## 10. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

```typescript
// âŒ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ (Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾)
const bsrData = await fetchBSR(query);        // 500ms
const keywords = await fetchKeywords(query);   // 300ms
// Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 800ms

// âœ“ ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ (Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾)
const [bsrData, keywords] = await Promise.all([
  fetchBSR(query),        // 500ms â”€â”
  fetchKeywords(query),   // 300ms â”€â”´â”€â–¶ 500ms (Ğ¼Ğ°ĞºÑ)
]);
// Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 500ms
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ĞŸĞĞ ĞĞ›Ğ›Ğ•Ğ›Ğ¬ĞĞ«Ğ• Ğ—ĞĞŸĞ ĞĞ¡Ğ«                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾:
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Keepa (500ms)
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Keywords (300ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                    800ms total

ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾:
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Keepa (500ms)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Keywords (300ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          500ms total (ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ 37%)
```

---

## Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸

- [Supabase Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)
- [Stripe Webhooks](https://stripe.com/docs/webhooks)
- [Cache-Aside Pattern](https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside)
